# Canvas 2.0 蒙版功能使用指南

## 功能概述

Canvas 2.0 现在支持强大的蒙版/剪切/遮罩功能，可以帮助您创建复杂的视觉效果和精确的图形编辑。

## 蒙版工具类型

### 1. 矩形蒙版 (Mask Tool)
- **工具图标**: ✂️ (剪刀图标)
- **功能**: 创建矩形蒙版区域
- **使用方法**: 选择工具后在画布上拖拽绘制矩形
- **效果**: 只显示矩形区域内的内容，区域外的内容被隐藏

### 2. 圆形蒙版 (Clip Tool)  
- **工具图标**: 📄 (图层图标)
- **功能**: 创建圆形蒙版区域
- **使用方法**: 选择工具后在画布上拖拽绘制圆形
- **效果**: 只显示圆形区域内的内容，区域外的内容被隐藏

## 操作步骤

### 创建蒙版
1. 在工具栏的"蒙版"分组中选择蒙版工具
2. 确保已选择要应用蒙版的图层
3. 在画布上拖拽绘制蒙版形状
4. 释放鼠标，蒙版自动应用到当前图层

### 蒙版管理
当选择蒙版工具时，右侧会显示"蒙版管理"面板，提供以下功能：

#### 模式选择
- **创建**: 创建新的蒙版
- **应用**: 将蒙版应用到图层
- **编辑**: 编辑现有蒙版

#### 蒙版形状选择
- **矩形蒙版**: 适用于规整的裁剪效果
- **圆形蒙版**: 适用于聚焦效果或圆形窗口
- **自由绘制蒙版**: 适用于复杂形状的蒙版

#### 图层蒙版列表
- 显示所有已应用蒙版的图层
- 可以切换蒙版的可见性
- 可以删除特定图层的蒙版

## 功能特点

### 图层级蒙版管理
- **独立性**: 每个图层可以有自己的蒙版
- **可见性控制**: 可以单独控制蒙版的显示/隐藏
- **非破坏性**: 蒙版操作不会永久删除内容

### 实时预览
- **蒙版绘制时**: 显示半透明红色边框预览
- **应用后**: 实时显示蒙版效果
- **可编辑**: 可以随时调整或移除蒙版

### 渲染优化
- **Fabric.js集成**: 使用Fabric.js的clipPath功能
- **高性能**: 硬件加速渲染
- **兼容性**: 与其他绘图工具完全兼容

## 使用场景

### 1. 图像裁剪
- 精确裁剪图片的特定区域
- 创建产品展示的聚焦效果

### 2. 局部显示
- 突出显示图层的重要部分
- 创建渐进式内容展示

### 3. 复杂布局
- 组合多个图层创建复杂设计
- 实现图片拼贴效果

### 4. 表达力增强
- 创建艺术性的视觉效果
- 实现专业级的图形设计

## 技术实现

### 底层技术
- **Fabric.js clipPath**: 使用原生剪切路径功能
- **非破坏性编辑**: 原始对象保持完整
- **Z-index管理**: 正确处理图层层级关系

### 数据结构
```javascript
maskData = {
  id: 'mask_id',
  type: 'rectangle' | 'circle' | 'freehand',
  layerId: 'target_layer_id',
  bounds: { left, top, width, height },
  visible: true
}
```

### API接口
- `createMaskForLayer(layerId, maskType, bounds)`: 创建蒙版
- `removeMaskFromLayerById(layerId)`: 移除蒙版  
- `toggleMaskVisibility(layerId, visible)`: 切换可见性
- `getLayerMask(layerId)`: 获取蒙版信息

## 注意事项

### 性能优化
- 大型图层应谨慎使用复杂蒙版
- 建议将复杂蒙版栅格化以提高性能

### 兼容性
- 蒙版功能与所有绘图工具兼容
- 支持图层的移动、旋转、缩放操作

### 导出
- 蒙版效果会在导出时保留
- 支持PNG、JPG等常见格式

## 快捷操作

### 快速蒙版
在蒙版管理面板底部提供的"快速蒙版"按钮：
- **矩形裁剪**: 一键创建并应用矩形蒙版
- **圆形遮罩**: 一键创建并应用圆形蒙版

### 键盘快捷键
- `M`: 快速切换到矩形蒙版工具
- `Shift+M`: 快速切换到圆形蒙版工具
- `Ctrl+M`: 显示/隐藏蒙版管理面板

## 故障排除

### 蒙版不显示
1. 检查蒙版是否可见
2. 确认图层有实际内容
3. 验证蒙版尺寸是否合理

### 性能问题
1. 减少同时使用的蒙版数量
2. 优化蒙版形状复杂度
3. 考虑栅格化复杂蒙版

通过这些功能，Canvas 2.0 的蒙版系统为用户提供了专业级的图形编辑能力，支持从简单裁剪到复杂艺术效果的各种应用场景。